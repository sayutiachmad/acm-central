var grid;var tbl=$("#table_for_data");var page_form=$("#mp_form");var validate_form;var notif_msg;jQuery(document).ready(function(a){prepare_select_parent();validate_form=page_form.validate({rules:{nv_nama_navigasi_:"required"},messages:{nv_nama_navigasi_:"Field ini harus diisi"},highlight:function(b){a(b).parents(".form-line").addClass("error")},unhighlight:function(b){a(b).parents(".form-line").removeClass("error")},errorPlacement:function(b,c){a(c).parents(".form-group").append(b)},submitHandler:function(b){save_data()}});load_navigation();addForm()});$("#reload_list").on("click",function(){load_navigation()});$("#action_save").on("click",function(){var a=$(".dd").nestable("serialize");$.ajax({url:base_url+"navigation/change_menu_order",type:"post",dataType:"json",data:{nav_nest:a}}).done(function(b){if(b.result>=0){showNotification("bg-green","Berhasil menyimpan navigasi","top","right",null,null)}else{showNotification("alert-danger","Terjadi kesalaan saat menyimpan navigasi","top","right",null,null)}}).fail(function(){showNotification("alert-danger","Terjadi kesalahan saat menyimpan navigais","top","right",null,null)}).always(function(){})});function bound_nestable(){$("#navigation-list").nestable({maxDepth:3,group:1,})}function bound_list(){$(".dd-item").on("mouseenter",".dd3-content",function(a){a.stopPropagation();$(".btn-peep").hide();$(this).find(".btn-peep").show()}).on("mouseleave",".dd3-content",function(a){a.stopPropagation();$(this).find(".btn-peep").hide()}).on("click",".dd3-content .action-edit",function(b){b.stopPropagation();var a=$(this).parent().data("nav-code");$(this).parent().find(".loader-nestable").show();get_navigation_detail(a)}).on("click",".dd3-content .action-remove",function(b){b.stopPropagation();var a=$(this).parent().data("nav-code");remove_data(a)});$(".dd-handle, .dd3-handle").empty()}function unbound_list(){$(".action-remove").unbind("click").unbind("mouseenter").unbind("mouseleave")}function open_modal(a){$("#modal_label").html(a);$("#modal_form").modal({backdrop:"static",keyboard:false})}function addForm(){$("#action_add").click(function(a){$('[name="nv_code_"]').val("");page_form[0].reset();$('[name="nv_parent_"]').val(" ").change();open_modal("Navigasi Baru")})}function save_data(){var a=page_form.serialize();$("#btn_submit").html("Processing...").attr("disabled","true");$("#modal_preloader").show("fast");$.ajax({url:base_url+"navigation/save_navigation",type:"POST",dataType:"json",data:a}).done(function(b){if(b.result==true){notif_msg="Berhasil menyimpan data!";showNotification("bg-green",notif_msg,"top","right",null,null);page_form.get(0).reset();$('[name="nv_parent_"]').val(" ").change();$("#modal_form").modal("toggle");load_navigation();prepare_select_parent()}else{notif_msg="Oops! Gagal menyimpan data!";showNotification("alert-danger",notif_msg,"top","right",null,null)}}).fail(function(){notif_msg="Oops! Terjadi kesalahan saat megirim data";showNotification("alert-danger",notif_msg,"top","right",null,null)}).always(function(){$("#btn_submit").html("SIMPAN").removeAttr("disabled");$("#modal_preloader").hide("fast")})}function get_navigation_detail(a){$.ajax({url:base_url+"navigation/get_navigation_detail",type:"post",dataType:"json",data:{nav_code_:a}}).done(function(b){if(b){open_modal("Ubah Navigasi");$('[name="nv_nama_navigasi_"]').val(b.result.navigation_name);$('[name="nv_link_"]').val(b.result.link);$('[name="nv_icon_"]').val(b.result.icon);$('[name="nv_parent_"]').val(b.result.parent).change();$('[name="nv_code_"]').val(b.result.id_navigation)}else{showNotification("alert-danger","Terjadi kesalahan saat meminta data","top","right",null,null)}}).fail(function(){showNotification("alert-danger","Terjadi kesalahan saat meminta data","top","right",null,null)}).always(function(){$(".loader-nestable").hide()})}function load_navigation(){$("#navigation-list").fadeOut("fast",function(){$("#list-preloader").fadeIn("fast");$("#alert-fail").fadeOut("fast")});$.ajax({url:base_url+"navigation/get_nestable_navigation",type:"post",dataType:"json",}).done(function(a){$(".dd").html("").html(a.result);bound_nestable();bound_list();$(".btn-peep").hide();$('[data-toggle="tooltip"]').tooltip();setTimeout(function(){$("#navigation-list").fadeIn("fast",function(){$("#list-preloader").fadeOut("fast")})},500)}).fail(function(){setTimeout(function(){$("#alert-fail").fadeIn("fast")},500)}).always(function(){setTimeout(function(){$("#list-preloader").fadeOut("fast")},500)})}function remove_data(a){$.confirm({title:"Konfirmasi",content:"Hapus Menu Navigasi?",type:"red",buttons:{remove:{text:"HAPUS",btnClass:"btn-danger",action:function(){$.alert({type:"orange",buttons:{close:{btnClass:"btn-primary"}},content:function(){var b=this;return $.ajax({url:base_url+"navigation/remove_navigation",type:"POST",dataType:"json",data:{nv_code_:a}}).done(function(d){var c=JSON.parse(d);b.setContent(c.msg);b.setTitle("Hapus Menu Navigasi");load_navigation();prepare_select_parent()}).fail(function(){b.setContent("Oops, terjadi kesalahan!")})}})}},cancel:function(){},}})}function prepare_select_parent(){var b=$('[name="nv_parent_"]');var c="";c+='<option value=" " selected disabled>- Pilih Parent -</option>';c+='<option value="0">Menu Utama</option>';c+='<option data-divider="true"></option>';var a;$.ajax({url:base_url+"navigation/get_navigation_parent",type:"POST",}).done(function(f){var d=JSON.parse(f);a="";for(var e=0;e<d.data.length;e++){a+='<option value="'+d.data[e].id_navigation+'">'+d.data[e].navigation_name+"</option>"}b.empty().append(c).append(a).selectpicker("refresh")}).fail(function(){b.empty().append(c);b.selectpicker("refresh")}).always(function(){})};