function reloadTable(){$("#reload_table").click(function(a){grid.ajax.reload()})}function open_modal(a){$("#modal_label").html(a),$("#modal_form").modal({backdrop:"static",keyboard:!1})}function addForm(){$("#action_add").click(function(a){$('[name="nv_code_"]').val(""),page_form[0].reset(),$('[name="nv_parent_"]').val(" ").change(),open_modal("Navigasi Baru")})}function save_data(){var a=page_form.serialize();$("#btn_submit").html("Processing...").attr("disabled","true"),$("#modal_preloader").show("fast"),$.ajax({url:base_url+"navigation/save_navigation",type:"POST",data:a}).done(function(a){JSON.parse(a).result?(notif_msg="Berhasil menyimpan data!",showNotification("bg-green",notif_msg,"top","right",null,null),page_form.get(0).reset(),$('[name="nv_parent_"]').val(" ").change(),$("#modal_form").modal("toggle"),grid.ajax.reload(),prepare_select_parent()):(notif_msg="Oops! Gagal menyimpan data!",showNotification("alert-danger",notif_msg,"top","right",null,null))}).fail(function(){notif_msg="Oops! Terjadi kesalahan saat megirim data",showNotification("alert-danger",notif_msg,"top","right",null,null)}).always(function(){$("#btn_submit").html("SIMPAN").removeAttr("disabled"),$("#modal_preloader").hide("fast")})}function remove_data(a){$.confirm({title:"Konfirmasi",content:"Hapus Menu Navigasi?",type:"red",buttons:{remove:{text:"HAPUS",btnClass:"btn-danger",action:function(){$.alert({type:"orange",buttons:{close:{btnClass:"btn-primary"}},content:function(){var t=this;return $.ajax({url:base_url+"navigation/remove_navigation",type:"POST",data:{nv_code_:a}}).done(function(a){var n=JSON.parse(a);t.setContent(n.msg),t.setTitle("Hapus Menu Navigasi"),grid.ajax.reload(),prepare_select_parent()}).fail(function(){t.setContent("Oops, terjadi kesalahan!")})}})}},cancel:function(){}}})}function prepare_select_parent(){var a=$('[name="nv_parent_"]'),t="";t+='<option value=" " selected disabled>- Pilih Parent -</option>',t+='<option value="0">Menu Utama</option>',t+='<option data-divider="true"></option>';var n;$.ajax({url:base_url+"navigation/get_navigation_parent",type:"POST"}).done(function(e){var i=JSON.parse(e);n="";for(var r=0;r<i.data.length;r++)if(0==i.data[r].parent){var o=i.data[r].id_navigation;n+='<option value="'+i.data[r].id_navigation+'">'+i.data[r].navigation_name+"</option>";for(var l=0;l<i.data.length;l++)if(i.data[l].parent==o){var d=i.data[l].id_navigation;n+='<option value="'+i.data[l].id_navigation+'">&nbsp; - '+i.data[l].navigation_name+"</option>";for(var s=0;s<i.data.length;s++)i.data[s].parent==d&&(n+='<option value="'+i.data[l].id_navigation+'">&nbsp;&nbsp; -- '+i.data[l].navigation_name+"</option>")}}a.empty().append(t).append(n).selectpicker("refresh")}).fail(function(){a.empty().append(t),a.selectpicker("refresh")}).always(function(){})}var grid,tbl=$("#table_for_data"),page_form=$("#mp_form"),validate_form,notif_msg,last_parent=0,last_nav=0;jQuery(document).ready(function(a){prepare_select_parent(),grid=tbl.DataTable({responsive:!0,sScrollX:!1,paging:!1,ajax:{url:base_url+"navigation/get_navigation"},columns:[{data:null,defaultContent:"",width:"5%",searchable:!1,orderable:!1},{data:"navigation_name",width:"35%"},{data:"link"},{data:"icon"},{data:"parent"},{data:null,defaultContent:"",width:"12%",class:"text-center"}],columnDefs:[{targets:1,render:function(a,t,n,e){var i=a;return n.parent>0&&(i=last_parent>0&&last_nav==n.parent?"&#x257C;&#x257C;  "+a:"&#x257C;  "+a),last_parent=n.parent,last_nav=n.id_navigation,i}},{targets:3,width:"5%",render:function(a,t,n,e){return"<center><i class='"+a+"'></i></center>"}},{targets:4,render:function(a,t,n,e){return a>0?n.parent_name:""}},{targets:5,searchable:!1,orderable:!1,render:function(a,t,n,e){var i="";return i+='<div class="btn-group">',i+='<button type="button" class="btn btn-block btn-xs bg-blue dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',i+='Options <span class="caret"></span>',i+="</button>",i+='<ul class="dropdown-menu pull-right">',i+='<li><a href="javascript:void(0);" class=" waves-effect waves-block action_edit"><i class="fa fa-edit"></i> Edit</a></li>',i+='<li><a href="javascript:void(0);" class=" waves-effect waves-block action_remove"><i class="fa fa-trash"></i> Delete</a></li>',i+="</ul>",i+="</div>"}}],order:[]}),grid.on("order.dt search.dt",function(){grid.column(0,{search:"applied",order:"applied"}).nodes().each(function(a,t){a.innerHTML=t+1})}).draw(),a("#table_for_data tbody").on("click",".action_edit",function(){open_modal("Ubah Navigasi"),a('[name="nv_nama_navigasi_"]').val(grid.row(a(this).parents("tr")).data().navigation_name),a('[name="nv_link_"]').val(grid.row(a(this).parents("tr")).data().link),a('[name="nv_icon_"]').val(grid.row(a(this).parents("tr")).data().icon),a('[name="nv_parent_"]').val(grid.row(a(this).parents("tr")).data().parent).change(),a('[name="nv_code_"]').val(grid.row(a(this).parents("tr")).data().id_navigation)}),a("#table_for_data tbody").on("click",".action_remove",function(){remove_data(grid.row(a(this).parents("tr")).data().id_navigation)}),validate_form=page_form.validate({rules:{nv_nama_navigasi_:"required"},messages:{nv_nama_navigasi_:"Field ini harus diisi"},highlight:function(t){a(t).parents(".form-line").addClass("error")},unhighlight:function(t){a(t).parents(".form-line").removeClass("error")},errorPlacement:function(t,n){a(n).parents(".form-group").append(t)},submitHandler:function(a){save_data()}}),reloadTable(),addForm()});