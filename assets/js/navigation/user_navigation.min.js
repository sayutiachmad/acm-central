var table_user=$("#table_user_list");var grid_user;var user_code="";var navtree;$(document).ready(function(){$(".select").selectpicker();initJsTree();$("#reload_user").on("click",function(){grid_user.ajax.reload()});$(".reload-nav").on("click",function(){if(user_code>0){callNavList()}});$("#copy-nav").on("click",function(){$("#modal-copy-from").modal("show");if(user_code>0){$("#user_to").val(user_code).change()}else{$("#user_to").val("default").selectpicker("refresh")}$("#user_from").val("default").selectpicker("refresh");$("#btn-confirm").addClass("disabled")});$("#user_from, #user_to").on("change",function(){var b=$("#user_from").find(":selected").val();var a=$("#user_to").find(":selected").val();if(b>0&&a>0){$("#btn-confirm").removeClass("disabled")}else{$("#btn-confirm").addClass("disabled")}});$("#btn-confirm").on("click",function(){var b=$("#user_from").find(":selected").val();var a=$("#user_to").find(":selected").val();copyUserNav(b,a)});grid_user=table_user.DataTable({sScrollX:false,dom:"ftipr",ajax:{url:base_url+"user/get_user",},order:[],columns:[{data:null,defaultContent:"",orderable:false,searchable:false},{data:"user"},{data:"user_fullname"},{data:"type"}]});grid_user.on("order.dt search.dt",function(){grid_user.column(0,{search:"applied",order:"applied"}).nodes().each(function(a,b){a.innerHTML=b+1})}).draw();$("#table_user_list tbody").on("click","tr",function(){var a=grid_user.row($(this)).data().id_user;var b=grid_user.row($(this)).data().user;if($(this).hasClass("selected")){$(this).removeClass("selected");$("#selected_user").html("");$('[name="up_user_"]').val("");user_code="";$("#parent-ref").html("");$("#tree-content").hide();$("#info-bar").show()}else{grid_user.$("tr.selected").removeClass("selected");$("#selected_user").html(" - [ "+b+" ]");$('[name="up_user_"]').val(a);user_code=a;$(this).addClass("selected");callNavList()}})});function callNavList(){$("#loading-bar").show();$("#info-bar").hide();$("#tree-content").hide();$("#alert-nav").hide();$.ajax({url:base_url+"navigation/get_nav_tree",type:"POST",dataType:"JSON",data:{user_code:user_code}}).error(function(){$("#loading-bar").hide();$("#alert-nav").show();$("#tree-content").hide()}).done(function(a){$("#tree-content").jstree().settings.core.data=a.response;$("#tree-content").jstree().refresh(true);$("#tree-content").jstree(true).open_all();$('li[data-nav-permission="checked"]').each(function(){$("#tree-content").jstree("check_node",$(this))});$('li[data-nav-permission="unchecked"]').each(function(){$("#tree-content").jstree("uncheck_node",$(this))});initNavAnchor()}).fail(function(){$("#loading-bar").hide();$("#alert-nav").show();$("#tree-content").hide()}).always(function(){$("#loading-bar").hide();$("#tree-content").show()})}function initJsTree(){navtree=$("#tree-content").jstree({plugins:["checkbox"],checkbox:{three_state:false},core:{themes:{name:"proton",responsive:true,icons:false}}})}function initNavAnchor(){$(".jstree-anchor").on("click",function(){var a=saveUserNav($(this).parents("li").data("nav-id"),$(this).hasClass("jstree-clicked"));if(!a){$(this).removeClass("jstree-clicked")}})}function saveUserNav(c,b){var a=true;$.ajax({url:base_url+"navigation/save_user_navigation",type:"post",dataType:"json",data:{nav_code:c,user_code:user_code,chk_state:b}}).done(function(d){var e;if(d.result){e="Success "+d.response+" user navigation";showNotification("alert-success",e,"top","right",null,null)}else{e="Failed "+d.response+" user navigation";showNotification("alert-danger",e,"top","right",null,null)}a=d.result}).fail(function(){}).always(function(){});return a}function copyUserNav(c,b){var a="";$("#btn-confirm").html('<i class="fas fa-sync fa-spin"></i> Loading . . .').attr("disabled","true");$.ajax({url:base_url+"navigation/copy_user_navigation",type:"post",dataType:"json",data:{user_from:c,user_to:b}}).error(function(){a="Oops! Something wrong while sending request to server";simple_alert("Something Wrong",a,"red")}).done(function(d){if(d.result){a="Success Copying User Navigation";simple_alert("Copy User Navigation",a,"green");$("#modal-copy-from").modal("hide");if(user_code>0){callNavList()}}else{a="Failed Copying User Navigation";simple_alert("Copy User Navigation",a,"red")}}).fail(function(){a="Oops! Something wrong while sending request to server";simple_alert("Something Wrong",a,"red")}).always(function(){$("#btn-confirm").html('<i class="fas fa-check"></i> CONFIRM').removeAttr("disabled")})};