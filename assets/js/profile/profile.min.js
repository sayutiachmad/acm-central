function save_profile(){var a=form_profile.serialize();$("#btn_submit_profile").html('<i class="fas fa-sync-alt fa-spin"></i> Processing...').attr("disabled","true"),$.ajax({url:base_url+"profile/change_profile",type:"POST",data:a}).done(function(a){var e=JSON.parse(a);e.result?1==e.result?(notif_msg="Berhasil menyimpan data!",showNotification("bg-green",notif_msg,"top","right",null,null),$("#profile-fullname").html($('[name="pr_fullname_"]').val()),$(".profile-fullname").text($('[name="pr_fullname_"]').val()),$("input").blur()):"exist"==e.result||(notif_msg="Oops! Gagal menyimpan data!",showNotification("alert-danger",notif_msg,"top","right",null,null)):(notif_msg="Oops! Gagal menyimpan data!",showNotification("alert-danger",notif_msg,"top","right",null,null))}).fail(function(){notif_msg="Oops! Terjadi kesalahan saat megirim data",showNotification("alert-danger",notif_msg,"top","right",null,null)}).always(function(){$("#btn_submit_profile").html('<i class="fas fa-check"></i> Submit').removeAttr("disabled")})}function save_password(){var a=form_password.serialize();$("#btn_submit_profile").html('<i class="fas fa-sync-alt fa-spin"></i> Processing...').attr("disabled","true"),$.ajax({url:base_url+"profile/change_password",type:"POST",data:a}).done(function(a){var e=JSON.parse(a);e.result?1==e.result?(notif_msg="Berhasil menyimpan data!",showNotification("bg-green",notif_msg,"top","right",null,null),$("#profile-fullname").html($('[name="pr_fullname_"]').val()),$(":password").val(""),$("#form-change-password")[0].reset()):"not_match"==e.result?(notif_msg="Gagal menyimpan data, Password baru dan konfirmasi password baru tidak cocok",showNotification("alert-danger",notif_msg,"top","right",null,null)):"not_exist"==e.result?(notif_msg="Gagal menyimpan data, Password lama tidak cocok",showNotification("alert-danger",notif_msg,"top","right",null,null)):(notif_msg="Oops! Gagal menyimpan data!",showNotification("alert-danger",notif_msg,"top","right",null,null)):(notif_msg="Oops! Gagal menyimpan data!",showNotification("alert-danger",notif_msg,"top","right",null,null))}).fail(function(){notif_msg="Oops! Terjadi kesalahan saat megirim data",showNotification("alert-danger",notif_msg,"top","right",null,null)}).always(function(){$("#btn_submit_profile").html('<i class="fas fa-check"></i> Submit').removeAttr("disabled")})}function load_img(){$.ajax({url:base_url+"profile/get_profpic",type:"post",data:{code_:$('[name="pr_user_code_"]').val()}}).done(function(a){data=JSON.parse(a),0!=data.image&&$(".profile-picture").attr("src",base_url+data.image.image.replace("./",""))}).fail(function(){console.log("error")}).always(function(){})}function readURL(a){if(a.files&&a.files[0]){var e=new FileReader;e.onload=function(a){$("#img_cropper").attr("src",a.target.result)},e.readAsDataURL(a.files[0])}}var form_profile=$("#form-change-profile"),form_password=$("#form-change-password"),validate_profile,validate_password,img=document.getElementById("img_cropper"),cropper,cropBoxData,canvasData;$(document).ready(function(){$("#image_upload").on("click touchstart",function(){$(this).val("")}),$("#image_upload").on("change",function(a){$("#modal_form").modal({backdrop:"static",keyboard:!1}),readURL(this)}),$("#modal_form").on("shown.bs.modal",function(){cropper=new Cropper(img,{autoCropArea:1,aspectRatio:1,ready:function(){cropper.setCropBoxData(cropBoxData).setCanvasData(canvasData)}})}).on("hidden.bs.modal",function(){cropBoxData=cropper.getCropBoxData(),canvasData=cropper.getCanvasData(),cropper.destroy()}),$("#btn_upload_logo").click(function(a){try{var e=$('[name="pr_user_code_"]').val(),t=cropper.getCroppedCanvas({maxWidth:800,maxHeight:800,imageSmoothingEnabled:!1}),o=t.toDataURL("image/png");$.confirm({title:"Konfirmasi",content:"Upload Gambar?",type:"blue",buttons:{remove:{text:"UPLOAD",btnClass:"btn-primary",action:function(){$.alert({type:"orange",buttons:{close:{btnClass:"btn-primary"}},content:function(){var a=this;return $.ajax({url:base_url+"profile/save_image",type:"POST",data:{imgdata:o,code:e}}).done(function(e){var t,o=JSON.parse(e);o.result?(t="Berhasil mengunggah gambar!",$("#modal_form").modal("toggle"),cropper.reset(),load_img()):t="Terjadi kesalahan saat mengunggah gambar! <br>"+o.msg,a.setContent(t),a.setTitle("Upload Gambar")}).fail(function(){a.setContent("Oops, terjadi kesalahan!")})}})}},cancel:function(){}}})}catch(a){console.log(a)}}),validate_profile=form_profile.validate({rules:{pr_username_:{required:!0},pr_fullname_:{required:!0}},highlight:function(a){$(a).parents(".form-line").addClass("error")},unhighlight:function(a){$(a).parents(".form-line").removeClass("error")},errorPlacement:function(a,e){$(e).parents(".form-group").append(a)},submitHandler:function(a){save_profile()}}),validate_password=form_password.validate({rules:{pr_old_password_:{required:!0},pr_new_password_:{required:!0},pr_confirm_new_password_:{required:!0,equalTo:"[name='pr_new_password_']"}},messages:{pr_confirm_new_password_:{equalTo:"Password baru tidak sama"}},highlight:function(a){$(a).parents(".form-line").addClass("error")},unhighlight:function(a){$(a).parents(".form-line").removeClass("error")},errorPlacement:function(a,e){$(e).parents(".form-group").append(a)},submitHandler:function(a){save_password()}})});