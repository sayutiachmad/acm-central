var grid;var tbl=$("#tb_plant");var page_form=$("#mp_form");var validate_form;var notif_msg;jQuery(document).ready(function(a){grid=tbl.DataTable({responsive:false,scrollX:true,ajax:{url:base_url+"plant/get_plant",},columns:[{data:null,defaultContent:"",width:"1px","class":"text-right",searchable:false,orderable:false},{data:null,defaultContent:"","class":"dt-nowrap"},{data:"Perusahaan_Name","class":"dt-nowrap"},{data:"Plant_ID","class":"text-center"},{data:"Plant_Name","class":"dt-nowrap"},{data:"Address1","class":"dt-nowrap"},{data:"Address2"},{data:"Phone"},{data:"Label","class":"dt-nowrap"},],columnDefs:[{targets:1,render:function(d,c,f,e){var b="";b+='<a href="javascript:void(0);" class="btn btn-xs btn-warning action_edit"><i class="fa fa-edit fa-xs"></i></a>';b+='<a href="javascript:void(0);" class="btn btn-xs btn-danger action_remove"><i class="fa fa-trash fa-xs"></i></a>';return"<center>"+b+"</center>"}}],});grid.on("order.dt search.dt",function(){grid.column(0,{search:"applied",order:"applied"}).nodes().each(function(b,c){b.innerHTML=c+1})}).draw();a("#tb_plant tbody").on("click",".action_edit",function(){open_modal("Ubah Data plant");a('[name="id_p"]').val(grid.row(a(this).parents("tr")).data().PPerusahaan_ID).change();a('[name="plant_id"]').val(grid.row(a(this).parents("tr")).data().Plant_ID).change();a('[name="plant_id"]').attr("readonly","");a('[name="plant_name"]').val(grid.row(a(this).parents("tr")).data().Plant_Name).change();a('[name="alamat_1"]').val(grid.row(a(this).parents("tr")).data().Address1).change();a('[name="alamat_2"]').val(grid.row(a(this).parents("tr")).data().Address2).change();a('[name="plant_label"]').val(grid.row(a(this).parents("tr")).data().Label).change();a('[name="phone"]').val(grid.row(a(this).parents("tr")).data().Phone).change();a('[name="kd_plant"]').val(grid.row(a(this).parents("tr")).data().Plant_ID)});a("#tb_plant tbody").on("click",".action_remove",function(){remove_data(grid.row(a(this).parents("tr")).data().Plant_ID)});validate_form=page_form.validate({rules:{plant_id:"required",plant_name:"required",},messages:{plant_id:"Field ini harus diisi",plant_name:"Field ini harus diisi",},highlight:function(b){a(b).parents(".form-line").addClass("error")},unhighlight:function(b){a(b).parents(".form-line").removeClass("error")},errorPlacement:function(b,c){a(c).parents(".form-group").append(b)},submitHandler:function(b){save_data()}});reloadTable();addForm()});function reloadTable(){$("#reload_table").click(function(a){grid.ajax.reload()})}function open_modal(a){$("#modal_label").html(a);$("#modal_form").modal({backdrop:"static",keyboard:false})}function addForm(){$("#action_add").click(function(a){reset_form();$('[name="mc_nrp_"]').removeProp("disabled");open_modal("Data Plant Baru")})}function reset_form(){page_form[0].reset();$('[name="plant_id"]').removeAttr("readonly");page_form.find("select").val("").change()}function fail_alert(b,a){$.alert({type:"red",buttons:{close:{btnClass:"btn-primary"}},title:b,content:a})}function save_data(){var b=page_form.serialize();$("#btn_submit").html("Processing...").attr("disabled","true");$("#modal_preloader").show("fast");var a="Tambah data mekanik";var c;$.ajax({url:base_url+"plant/save_plant",type:"POST",data:b}).done(function(e){var d=JSON.parse(e);if(d.result==true){notif_msg="Berhasil menyimpan data!";showNotification("bg-green",notif_msg,"top","right",null,null);reset_form();$("#modal_form").modal("toggle");grid.ajax.reload()}else{notif_msg="Oops! ID PLant Telah Digunakan !";$("#modal_form").modal("toggle");showNotification("alert-danger",notif_msg,"top","right",null,null)}}).fail(function(){notif_msg="Oops! Terjadi kesalahan saat megirim data";showNotification("alert-danger",notif_msg,"top","right",null,null)}).always(function(){$("#btn_submit").html("SIMPAN").removeAttr("disabled");$("#modal_preloader").hide("fast")})}function remove_data(a){$.confirm({title:"Konfirmasi",content:"Hapus Data Plant ?",type:"red",buttons:{remove:{text:"HAPUS",btnClass:"btn-danger",action:function(){$.alert({type:"orange",buttons:{close:{btnClass:"btn-primary"}},content:function(){var b=this;return $.ajax({url:base_url+"plant/remove_plant",type:"POST",data:{kd_plant:a}}).done(function(d){var c=JSON.parse(d);b.setContent(c.msg);b.setTitle("Hapus Data");grid.ajax.reload()}).fail(function(){b.setContent("Oops, terjadi kesalahan!")})}})}},cancel:function(){},}})};