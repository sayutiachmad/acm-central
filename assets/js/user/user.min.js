var grid;var tbl=$("#table_for_data");var page_form=$("#mp_form");var page_form_edit=$("#mp_form_edit");var validate_form;var validate_form_edit;var notif_msg;jQuery(document).ready(function(a){grid=tbl.DataTable({responsive:false,rowReorder:true,ajax:{url:base_url+"user/get_user",},columns:[{data:null,defaultContent:"",width:"5%",searchable:false,orderable:false},{data:"user",width:"35%"},{data:"type",width:"13%"},{data:"status"},{data:null,defaultContent:"",width:"8%"}],columnDefs:[{targets:3,width:"5%",render:function(d,c,f,e){var b;if(d==1){b='<span class="badge bg-green">Active</span>'}else{b='<span class="badge bg-red">Disabled</span>'}return"<center>"+b+"</center>"}},{targets:4,orderable:false,searchable:false,render:function(d,c,f,e){var b="";b+='<div class="btn-group">';b+='<button type="button" class="btn btn-xs btn-block bg-blue dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">';b+='Options <span class="caret"></span>';b+="</button>";b+='<ul class="dropdown-menu pull-right">';b+='<li><a href="javascript:void(0);" class=" waves-effect waves-block action_edit"><i class="fa fa-edit"></i> Edit</a></li>';b+='<li><a href="javascript:void(0);" class=" waves-effect waves-block action_reset"><i class="fa fa-redo"></i> Reset Password</a></li>';b+='<li><a href="javascript:void(0);" class=" waves-effect waves-block action_remove"><i class="fa fa-trash"></i> Delete</a></li>';b+="</ul>";b+="</div>";return"<center>"+b+"</center>"}}],order:[[1,"asc"]]});grid.on("order.dt search.dt",function(){grid.column(0,{search:"applied",order:"applied"}).nodes().each(function(b,c){b.innerHTML=c+1})}).draw();a("#table_for_data tbody").on("click",".action_edit",function(){open_modal_edit("");a('#mp_form_edit [name="ua_username_"]').val(grid.row(a(this).parents("tr")).data().user);a('#mp_form_edit [name="ua_fullname_"]').val(grid.row(a(this).parents("tr")).data().user_fullname);a('#mp_form_edit [name="ua_user_type_"]').val(grid.row(a(this).parents("tr")).data().id_user_type).change();var b=grid.row(a(this).parents("tr")).data().status;if(b==1){a('#mp_form_edit [name="ua_status_"]').prop("checked",true)}else{a('#mp_form_edit [name="ua_status_"]').prop("checked",false)}a('[name="ua_code_"]').val(grid.row(a(this).parents("tr")).data().id_user)});a("#table_for_data tbody").on("click",".action_remove",function(){remove_data(grid.row(a(this).parents("tr")).data().id_user)});a("#table_for_data tbody").on("click",".action_reset",function(){var b=grid.row(a(this).parents("tr")).data().id_user;reset_pwd(b)});validate_form=page_form.validate({rules:{ua_username_:"required",ua_fullname_:"required",ua_password_:"required",ua_user_type_:"required",},messages:{ua_username_:"Field ini harus diisi",ua_fullname_:"Field ini harus diisi",ua_password_:"Field ini harus diisi",ua_user_type_:"Field ini harus diisi",},highlight:function(b){a(b).parents(".form-line").addClass("error")},unhighlight:function(b){a(b).parents(".form-line").removeClass("error")},errorPlacement:function(b,c){a(c).parents(".form-group").append(b)},submitHandler:function(b){save_data()}});validate_form_edit=page_form_edit.validate({rules:{ua_username_:"required",ua_user_type_:"required",},messages:{ua_username_:"Field ini harus diisi",ua_user_type_:"Field ini harus diisi",},highlight:function(b){a(b).parents(".form-line").addClass("error")},unhighlight:function(b){a(b).parents(".form-line").removeClass("error")},errorPlacement:function(b,c){a(c).parents(".form-group").append(b)},submitHandler:function(b){change_data()}});reloadTable();addForm()});function reloadTable(){$("#reload_table").click(function(a){grid.ajax.reload()})}function open_modal(a){$("#modal_label").html(a);$("#modal_form").modal({backdrop:"static",keyboard:false})}function open_modal_edit(){$("#modal_form_edit").modal({backdrop:"static",keyboard:false,})}function addForm(){$("#action_add").click(function(a){$('[name="nv_code_"]').val("");open_modal("Navigasi Baru")})}function save_data(){var a=page_form.serialize();$("#btn_submit").html("Processing...").attr("disabled","true");$("#modal_preloader").show("fast");$("#alert-modal").hide();$.ajax({url:base_url+"user/save_user",type:"POST",data:a}).done(function(c){var b=JSON.parse(c);if(b.result==true){notif_msg="Berhasil menyimpan data!";showNotification("bg-green",notif_msg,"top","right",null,null);page_form.get(0).reset();$('[name="ua_user_type_"]').val("0").change();$("#modal_form").modal("toggle");grid.ajax.reload()}else{if(b.result=="exist"){notif_msg="Gagal menyimpan data, <b>username sudah terpakai!</b>";$("#alert_msg").html(notif_msg);$("#alert_modal").fadeIn("fast")}else{notif_msg="Oops! Gagal menyimpan data!";showNotification("alert-danger",notif_msg,"top","right",null,null)}}}).fail(function(){notif_msg="Oops! Terjadi kesalahan saat megirim data";showNotification("alert-danger",notif_msg,"top","right",null,null)}).always(function(){$("#btn_submit").html("SIMPAN").removeAttr("disabled");$("#modal_preloader").hide("fast")})}function change_data(){var a=page_form_edit.serialize();$("#btn_submit_edit").html("Processing...").attr("disabled","true");$("#modal_preloader_edit").show("fast");$.ajax({url:base_url+"user/change_user",type:"POST",data:a}).done(function(c){var b=JSON.parse(c);if(b.result==true){notif_msg="Berhasil menyimpan data!";showNotification("bg-green",notif_msg,"top","right",null,null);page_form_edit.get(0).reset();page_form_edit.find('[name="ua_user_type_"]').val("0").change();$("#modal_form_edit").modal("toggle");grid.ajax.reload()}else{notif_msg="Oops! Gagal menyimpan data!";showNotification("alert-danger",notif_msg,"top","right",null,null)}}).fail(function(){notif_msg="Oops! Terjadi kesalahan saat megirim data";showNotification("alert-danger",notif_msg,"top","right",null,null)}).always(function(){$("#btn_submit_edit").html("SIMPAN").removeAttr("disabled");$("#modal_preloader_edit").hide("fast")})}function reset_pwd(a){$.confirm({title:"Konfirmasi",content:"Reset password user?",type:"orange",buttons:{remove:{text:"RESET",btnClass:"bg-primary",action:function(){$.alert({type:"orange",buttons:{close:{btnClass:"btn-primary"}},content:function(){var b=this;return $.ajax({url:base_url+"user/reset_password",type:"POST",data:{ua_code_:a}}).done(function(d){var c=JSON.parse(d);b.setContent(c.msg);b.setTitle("Reset Password User");grid.ajax.reload()}).fail(function(){b.setContent("Oops, terjadi kesalahan!")})}})}},cancel:function(){},}})}function remove_data(a){$.confirm({title:"Konfirmasi",content:"Hapus user?",type:"red",buttons:{remove:{text:"HAPUS",btnClass:"btn-danger",action:function(){$.alert({type:"orange",buttons:{close:{btnClass:"btn-primary"}},content:function(){var b=this;return $.ajax({url:base_url+"user/remove_user",type:"POST",data:{ua_code_:a}}).done(function(d){var c=JSON.parse(d);b.setContent(c.msg);b.setTitle("Hapus User Account");grid.ajax.reload()}).fail(function(){b.setContent("Oops, terjadi kesalahan!")})}})}},cancel:function(){},}})};