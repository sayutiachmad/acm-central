var grid;var grid_sub;var tbl=$("#table_for_data");var tbl_sub=$("#table_for_data_sub");var page_form=$("#mp_form");var page_form_sub=$("#mp_form_sub");var validate_form;var validate_form_sub;var validate_form_edit;var notif_msg;var select_parent=$('[name="cc_parent_"]');$(document).ready(function(){addForm();addFormSub();reloadTable();reloadTableSub();prepare_select_parent();grid=tbl.DataTable({initComplete:function(b,a){$(".dropdown-toggle").dropdown();if(tbl.data("parent")!="0"){$("#parent-ref").html(" - ["+tbl.data("parent")+"]")}},ajax:{url:base_url+"common_code/get_detail",method:"post",data:function(a){a.cc_parent_=tbl.data("parent")}},columns:[{data:null,defaultContent:"",width:"5%",searchable:false,orderable:false},{data:"code",width:"10%"},{data:"code_name",width:"auto"},{data:"description1",width:"auto"},{data:"description2",width:"auto"},{data:"description3",width:"auto"},{data:"amt1",width:"auto"},{data:"amt2",width:"auto"},{data:"amt3",width:"auto"},{data:"status",width:"3%"},{data:"sort",defaultContent:"",render:function(c,b,e,d){var a="<center>";var f=e.max_sort;if(c==1){a+='<button type="button" class="btn btn-success btn-xs move-down"><i class="fas fa-arrow-down"></i></button>'}else{if(c==f){a+='<button type="button" class="btn btn-success btn-xs move-up"><i class="fas fa-arrow-up"></i></button>'}else{if(c>1){a+='<button type="button" class="btn btn-success btn-xs move-up"><i class="fas fa-arrow-up"></i></button>';a+='<button type="button" class="btn btn-success btn-xs move-down"><i class="fas fa-arrow-down"></i></button>'}}}a+="</center>";return a}},{data:null,defaultContent:"",width:"5%"},],columnDefs:[{targets:9,searchable:false,orderable:false,render:function(d,c,f,e){var b=(d==1?"checked":"");var a='<div class="checkbox checkbox-custom checkbox-inline">';a+='<input id="'+f.code+'" type="checkbox" class="filled-in chk-col-blue status-common" data-head="'+f.code+'" data-parent="'+f.parent_code+'" '+b+"/>";a+='<label for="'+f.code+'"></label>';a+="</div>";return"<center>"+a+"</center>"}},{targets:11,searchable:false,sortable:false,render:function(c,b,e,d){var a="";a+='<div class="btn-group">';a+='<button type="button" class="btn btn-block btn-xs bg-blue dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">';a+='Options <span class="caret"></span>';a+="</button>";a+='<ul class="dropdown-menu pull-right">';a+='<li><a href="javascript:void(0);" class=" waves-effect waves-block action_edit"><i class="fa fa-edit"></i> Edit</a></li>';a+='<li><a href="javascript:void(0);" class=" waves-effect waves-block action_remove"><i class="fa fa-trash"></i> Delete</a></li>';a+="</ul>";a+="</div>";return a}}],order:[],});grid.on("order.dt search.dt",function(){grid.column(0,{search:"applied",order:"applied"}).nodes().each(function(a,b){a.innerHTML=b+1})}).draw();$("#table_for_data tbody").on("click",".status-common",function(){save_status_detail(this)}).on("click",".action_edit",function(){$('[name="cc_parent_"]').val(grid.row($(this).parents("tr")).data().code_parent).change();$('[name="cc_det_code_"]').val(grid.row($(this).parents("tr")).data().code).attr("readonly","true");$('[name="cc_code_"]').val(grid.row($(this).parents("tr")).data().code);$('[name="cc_code_name_"]').val(grid.row($(this).parents("tr")).data().code_name);$('[name="cc_desc_1_"]').val(grid.row($(this).parents("tr")).data().description1);$('[name="cc_desc_2_"]').val(grid.row($(this).parents("tr")).data().description2);$('[name="cc_desc_3_"]').val(grid.row($(this).parents("tr")).data().description3);$('[name="cc_amt_1_"]').val(grid.row($(this).parents("tr")).data().amt1);$('[name="cc_amt_2_"]').val(grid.row($(this).parents("tr")).data().amt2);$('[name="cc_amt_3_"]').val(grid.row($(this).parents("tr")).data().amt3);open_modal("Ubah Code Detail")}).on("click",".action_remove",function(){var b=grid.row($(this).parents("tr")).data().code;var a=grid.row($(this).parents("tr")).data().parent_code;remove_data(b,a,2)}).on("click",".move-up",function(){var b=grid.row($(this).parents("tr")).data().code;var a=grid.row($(this).parents("tr")).data().parent_code;var d=grid.row($(this).parents("tr")).data().sort;var c="up";save_sort(b,a,c,d)}).on("click",".move-down",function(){var b=grid.row($(this).parents("tr")).data().code;var a=grid.row($(this).parents("tr")).data().parent_code;var d=grid.row($(this).parents("tr")).data().sort;var c="down";save_sort(b,a,c,d)});grid_sub=tbl_sub.DataTable({bLengthChange:false,pagingType:"simple_numbers",initComplete:function(b,a){},drawCallback:function(a){$('[data-toggle="tooltip"], .dropdown-toggle').tooltip({container:"body"});$(".dropdown-toggle").dropdown()},ajax:{url:base_url+"common_code/get_head",},columns:[{data:null,defaultContent:"",width:"10%",searchable:false,orderable:false},{data:"code",width:"30%"},{data:"code_name",width:"auto"},],columnDefs:[{targets:2,render:function(e,d,g,f){var c=(g.status==1?"checked":"");var a='<div class="checkbox checkbox-custom checkbox-inline pull-right" data-toggle="tooltip"  data-original-title="Use" data-placement="top">';a+='<input id="'+g.code+'" type="checkbox" class="filled-in chk-col-blue status-head" data-head="'+g.code+'" data-parent="'+g.parent_code+'" '+c+"/>";a+='<label for="'+g.code+'" class="label-status-head"></label>';a+="</div>";var b="";b+='<div class="btn-group pull-right">';b+='<button type="button" class="btn btn-default btn-xs font-small dropdown-toggle dropdown-opt-sub" data-original-title="Option" data-placement="top" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">';b+='<i class="fa fa-ellipsis-v"></i>';b+="</button>";b+='<ul class="dropdown-menu pull-right">';b+='<li><a href="javascript:void(0);" class=" waves-effect waves-block action_edit_sub no-select"><i class="fa fa-edit"></i> Edit</a></li>';b+='<li><a href="javascript:void(0);" class=" waves-effect waves-block action_remove_sub no-select"><i class="fa fa-trash"></i> Delete</a></li>';b+="</ul>";b+="</div>";return e+b+a}}],order:[[1,"asc"]]});grid_sub.on("order.dt search.dt",function(){grid_sub.column(0,{search:"applied",order:"applied"}).nodes().each(function(a,b){a.innerHTML=b+1})}).draw();$("#table_for_data_sub tbody").on("click",".action_edit_sub",function(){open_modal_sub("Ubah Head Code");$('[name="cc_head_code_"]').val(grid_sub.row($(this).parents("tr")).data().code).attr("readonly","true");$('[name="cc_head_code_name_"]').val(grid_sub.row($(this).parents("tr")).data().code_name);$('[name="cc_head_desc_"]').val(grid_sub.row($(this).parents("tr")).data().code_name);$('[name="cc_code_sub_"]').val(grid_sub.row($(this).parents("tr")).data().code);$('[data-toggle="dropdown"]').parent().removeClass("open");return false}).on("click",".action_remove_sub",function(){var b=grid_sub.row($(this).parents("tr")).data().code;var a=grid_sub.row($(this).parents("tr")).data().parent_code;remove_data(b,a,1);$('[data-toggle="dropdown"]').parent().removeClass("open");return false}).on("click","tr",function(){var a=grid_sub.row($(this)).data().code;var b=grid_sub.row($(this)).data().code_name;if($(this).hasClass("selected")){$(this).removeClass("selected");tbl.data("parent",0);$("#parent-ref").html("")}else{grid_sub.$("tr.selected").removeClass("selected");tbl.data("parent",a);$("#parent-ref").html(" - [ "+a+" ] "+b);$(this).addClass("selected")}grid.ajax.reload()}).on("click",".dropdown-opt-sub",function(a){$(".dropdown-opt-sub").dropdown("toggle");return false}).on("click",".status-head",function(a){save_status_detail(this)});validate_form=page_form.validate({rules:{cc_code_:"required",cc_code_name_:"required",cc_parent_:"required",},messages:{cc_code_:"Field ini harus diisi",cc_code_name_:"Field ini harus diisi",cc_parent_:"Field ini harus diisi",},highlight:function(a){$(a).parents(".form-line").addClass("error")},unhighlight:function(a){$(a).parents(".form-line").removeClass("error")},errorPlacement:function(a,b){$(b).parents(".form-group").append(a)},submitHandler:function(a){save_data()}});validate_form_sub=page_form_sub.validate({rules:{cc_head_code_:"required",cc_head_code_name_:"required",},messages:{cc_head_code_:"Field ini harus diisi",cc_head_code_name_:"Field ini harus diisi",},highlight:function(a){$(a).parents(".form-line").addClass("error")},unhighlight:function(a){$(a).parents(".form-line").removeClass("error")},errorPlacement:function(a,b){$(b).parents(".form-group").append(a)},submitHandler:function(a){save_data_sub()}})});function reloadTable(){$("#reload_table").click(function(a){grid.ajax.reload()})}function open_modal(b){$("#modal_label").html(b);$("#alert_modal_sub").hide();var a=$("#table_for_data").data("parent");if(a!="0"){select_parent.val(a).change()}else{select_parent.val(" ").change()}$("#modal_form").modal({backdrop:"static",keyboard:false})}function addForm(){$("#action_add").click(function(a){$('[name="cc_det_code_"]').removeAttr("readonly");$('[name="cc_code_"]').val("");page_form.get(0).reset();open_modal("Common Code Baru")})}function reloadTableSub(){$("#reload_table_sub").click(function(a){reload_sub()})}function reload_sub(){$("#table_for_data").data("parent",0);$("#parent-ref").html("");grid_sub.ajax.reload();grid.ajax.reload()}function open_modal_sub(a){$("#modal_label_sub").html(a);$("#alert_modal_sub").hide();page_form_sub.get(0).reset();$('[name="cc_head_code_"]').val("").removeAttr("readonly");$('[name="cc_code_sub_"]').val("");$("#modal_form_sub").modal({backdrop:"static",keyboard:false})}function addFormSub(){$("#action_add_sub").click(function(a){open_modal_sub("Head Code Baru")})}function save_data(){var a=page_form.serialize();$("#btn_submit").html("Processing...").attr("disabled","true");$("#modal_preloader").show("fast");$("#alert-modal").hide();$.ajax({url:base_url+"common_code/save_data",type:"POST",data:a}).done(function(c){var b=JSON.parse(c);if(b.result==true){notif_msg="Berhasil menyimpan data!";showNotification("bg-green",notif_msg,"top","right",null,null);page_form.get(0).reset();$('[name="cc_parent_"]').val(" ").change();$("#modal_form").modal("toggle");grid.ajax.reload()}else{if(b.result=="exist"){notif_msg="Gagal menyimpan data, <b>Code sudah terpakai!</b>";$("#alert_msg").html(notif_msg);$("#alert_modal").fadeIn("fast")}else{notif_msg="Oops! Gagal menyimpan data!";showNotification("alert-danger",notif_msg,"top","right",null,null)}}}).fail(function(){notif_msg="Oops! Terjadi kesalahan saat megirim data";showNotification("alert-danger",notif_msg,"top","right",null,null)}).always(function(){$("#btn_submit").html("SIMPAN").removeAttr("disabled");$("#modal_preloader").hide("fast")})}function save_data_sub(){var a=page_form_sub.serialize();$("#btn_submit_sub").html("Processing...").attr("disabled","true");$("#modal_preloader_sub").show("fast");$.ajax({url:base_url+"common_code/save_head",type:"POST",data:a}).done(function(c){var b=JSON.parse(c);if(b.result==true){notif_msg="Berhasil menyimpan data!";showNotification("bg-green",notif_msg,"top","right",null,null);page_form_sub.get(0).reset();$("#modal_form_sub").modal("toggle");reload_sub();prepare_select_parent()}else{if(b.result=="exist"){notif_msg="Gagal menyimpan data, <b>Head code sudah terpakai!</b>";$("#alert_msg_sub").html(notif_msg);$("#alert_modal_sub").fadeIn("fast")}else{notif_msg="Oops! Gagal menyimpan data!";showNotification("alert-danger",notif_msg,"top","right",null,null)}}}).fail(function(){notif_msg="Oops! Terjadi kesalahan saat megirim data";showNotification("alert-danger",notif_msg,"top","right",null,null)}).always(function(){$("#btn_submit_sub").html("SIMPAN").removeAttr("disabled");$("#modal_preloader_sub").hide("fast")})}function remove_data(d,c,b){var a="Detail Code";if(b==1){a="Head Code"}$.confirm({title:"Konfirmasi",content:"Hapus "+a+" "+d+"?",type:"red",buttons:{remove:{text:"HAPUS",btnClass:"btn-danger",action:function(){$.alert({type:"orange",buttons:{close:{btnClass:"btn-primary"}},content:function(){var e=this;return $.ajax({url:base_url+"common_code/remove_common",type:"POST",data:{cc_code_:d,cc_parent_:c}}).done(function(g){var f=JSON.parse(g);e.setContent(f.msg);e.setTitle("Hapus User Account");if(b==1){grid_sub.ajax.reload();$("#parent-ref").html("");tbl.data("parent",0);grid.ajax.reload()}else{grid.ajax.reload()}}).fail(function(){e.setContent("Oops, terjadi kesalahan!")})}})}},cancel:function(){},}})}function prepare_select_parent(){var b="";b+='<option value=" " selected disabled>- Pilih Head Code -</option>';var a;$.ajax({url:base_url+"common_code/get_head",type:"POST",}).done(function(f){var c=JSON.parse(f);a="";for(var d=0;d<c.data.length;d++){var e=c.data[d].id_navigation;a+='<option value="'+c.data[d].code+'"> [ '+c.data[d].code+" ] "+c.data[d].code_name+"</option>"}select_parent.empty().append(b).append(a).selectpicker("refresh")}).fail(function(){select_parent.empty().append(b);select_parent.selectpicker("refresh")}).always(function(){})}function save_status_detail(d){disable_checkbox(d);var b=$(d).data("head");var c=$(d).data("parent");var a=d.checked;$.ajax({url:base_url+"common_code/save_status_code",type:"POST",data:{cc_head_:b,cc_parent_:c,cc_checked_:a}}).done(function(f){var e=JSON.parse(f);if(e.result){notif_msg="Berhasil menyimpan status code detail!";showNotification("bg-green",notif_msg,"top","right",null,null)}else{notif_msg="Oops! terjadi kesalahan saat menyimpan data";showNotification("alert-danger",notif_msg,"top","right",null,null);$(d).attr("checked",!checked)}}).fail(function(){notif_msg="Oops! terjadi kesalahan saat mengirim data";showNotification("alert-danger",notif_msg,"top","right",null,null);$(d).attr("checked",!checked)}).always(function(){enable_checkbox(d)})}function disable_checkbox(a){$(a).attr("disabled","true").removeClass("chk-col-blue").addClass("chk-col-grey")}function enable_checkbox(a){$(a).removeAttr("disabled").removeClass("chk-col-grey").addClass("chk-col-blue")}function save_sort(b,c,d,a){$.ajax({url:base_url+"common_code/move_sort",type:"POST",data:{cc_head_:b,cc_parent_:c,cc_direction_:d,cc_last_position_:a}}).done(function(f){var e=JSON.parse(f);if(e.result){grid.ajax.reload()}}).fail(function(){}).always(function(){})};