var child_level="";var data_parent="";var data_head="";var node_text="";var ig_form=$("#mp_form");var validate_form;$(document).ready(function(){$("#tree").jstree({core:{themes:{name:"proton",responsive:true,icons:false}}});$("#tree").on("ready.jstree",function(){$("#tree").jstree("open_all")}).on("select_node.jstree",function(b,a){child_level=a.node.li_attr.child_level;data_parent=a.node.li_attr.data_parent;data_head=a.node.li_attr.data_head;data_name=a.node.li_attr.data_name;node_text=$.trim(a.node.text);console.log(child_level);if(child_level<3){$("#add_child").removeAttr("disabled")}$("#edit_data").removeAttr("disabled")});$("#add_child").on("click",function(){$("#sub_title").html(" - Tambah Child");$('[name="cc_parent_"]').val(data_head);$('[name="edit"]').val("0");$('[name="cc_code_"]').val("")});$("#edit_data").on("click",function(){$("#sub_title").html(" - Ubah Data");$('[name="cc_parent_"]').val(data_parent);$('[name="cc_det_code_"]').val(data_head);$('[name="edit"]').val("1");$('[name="cc_code_"]').val(data_head);$('[name="cc_code_name_"]').val(data_name)});$("#btn_cancel").on("click",function(){ig_form.trigger("reset")});validate_form=ig_form.validate({ignoreTitle:true,rules:{cc_parent_:{required:true,},cc_det_code_:{required:true,},cc_code_name_:{required:true,},},highlight:function(a){$(a).parents(".form-line").addClass("error")},unhighlight:function(a){$(a).parents(".form-line").removeClass("error")},errorPlacement:function(a,b){$(b).parents(".form-group").append(a)},submitHandler:function(a){save_data()}})});function save_data(){var a=ig_form.serialize();$("#btn_submit").html('<i class="fas fa-sync fa-spin"></i> Processing...').attr("disabled","true");$("#modal_preloader").show("fast");$.ajax({url:base_url+"common_code/save_data",type:"POST",data:a}).done(function(c){var b=JSON.parse(c);if(b.result==true){notif_msg="Berhasil menyimpan data!";showNotification("bg-green",notif_msg,"top","right",null,null);setTimeout(window.location.replace(base_url+"common_code/item_group"),2500)}else{if(b.result=="exist"){notif_msg="Gagal menyimpan data, <b>ID ITEM sudah terpakai!</b>";$("#alert_msg").html(notif_msg);$("#alert_modal").fadeIn("fast");showNotification("alert-danger",notif_msg,"top","right",null,null)}else{notif_msg="Oops! Gagal menyimpan data!";showNotification("alert-danger",notif_msg,"top","right",null,null)}}}).fail(function(){notif_msg="Oops! Terjadi kesalahan saat megirim data";showNotification("alert-danger",notif_msg,"top","right",null,null)}).always(function(){$("#btn_submit").html('<i class="fa fa-save"></i> Simpan').removeAttr("disabled");$("#modal_preloader").hide("fast")})};